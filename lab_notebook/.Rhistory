setwd("~/current_research/CPOM_Flux/lab_notebook")
bod <- c(1, 6, 7, 5, 2, 8, 4, 10, 3, 9)
vialT0 <- 1:10
vialTF <- 15:24
temp <- rep(21.0, 10)
pressure <- rep(30.49, 10)
time0 <- c("2016-02-18 09:45", "2016-02-18 09:50", "2016-02-18 09:54", "2016-02-18 09:56", "2016-02-18 10:00", "2016-02-18 10:05", "2016-02-18 10:09", "2016-02-18 10:12", "2016-02-18 10:17", "2016-02-18 10:21")
BeginBuretT0 <- c(1.455, 2.25, 3.05, 3.90, 4.80, 5.60, 6.40, 7.20, 8.005, 0.00)
EndBuretT0 <- c(2.25, 3.05, 3.90, 4.80, 5.60, 6.40, 7.20, 8.005, 8.80, 0.805)
timeF <- c("2016-02-18 19:47", "2016-02-18 19:50", "2016-02-18 19:52", "2016-02-18 19:55", "2016-02-18 19:57", "2016-02-18 20:00", "2016-02-18 20:02", "2016-02-18 20:05", "2016-02-18 20:07", "2016-02-18 20:09")
BeginBuretTF <- c(5.05, 5.60, 6.30, 6.90, 7.60, 8.15, 8.75, 4.50, 5.20, 5.80)
EndBuretTF <- c(5.60, 6.30, 6.90, 7.60, 8.15, 8.75, 9.35, 5.20, 5.80, 6.50)
A <- rep(0.0028, 10)
Replvol <- c(55, 53, 54, 46, 53, 53, 54, 53, 55, 54)
RmeasT0 <- EndBuretT0 - BeginBuretT0
RmeasTF <- EndBuretTF - BeginBuretTF
# create data.frame
sod <- data.frame(bod, vialT0, vialTF, temp, pressure, A, time0, timeF, RmeasT0, RmeasTF, Replvol)
write.table(sod, "data/leached_litter_SP_sod_18feb2016.csv", sep = ",", row.names = F, quote = F)
std.begin.buret <- c(0.00, 0.20, 0.35)
std.end.buret <- c(0.20, 0.35, 0.50)
blank.begin1 <- c(0.50, 0.80, 1.15)
blank.end1 <- c(0.655, 1.00, 1.30)
blank.begin2 <- c(0.655, 1.00, 1.30)
blank.end2 <- c(0.80, 1.15, 1.455)
Vstd <- 0.2
MnCl.vol <- 0.085
NaI.vol <- 0.085
Nstd <- 0.01
E <- 5598
MnCl.DO <- 0.018
### Calculations
stds <- std.end.buret - std.begin.buret
blank.first <- blank.end1 - blank.begin1
blank.second <- blank.first + (blank.end2 - blank.begin2)
Rstd <- mean(stds)
blank.second.vol <- blank.second - blank.first
Rblk <- mean(blank.first - blank.second.vol)
Vreg <- sum(MnCl.vol, NaI.vol)
DOreg <- MnCl.DO * MnCl.vol
## Output
std <- data.frame(Rstd, Rblk, Vstd, Nstd, E, Vreg, DOreg)
write.table(std, file = "./data/winkler_standardization_18feb2016.csv", quote = F, row.names = F, sep = ",")
date <- rep("2016-02-18", 4)
vial <- c(11:14)
BeginBuret <- c(0.805, 1.90, 2.95, 3.95)
EndBuret <- c(1.90, 2.95, 3.95, 5.05)
repl <- data.frame(date, vial, Rmeas)
# replace date with date of run
write.table(repl, "./data/repl_water_18feb2016.csv", quote = F, row.names = F, sep = ",")
repl <- data.frame(date, vial, Rmeas)
Rmeas <- EndBuret - BeginBuret
## Output
repl <- data.frame(date, vial, Rmeas)
# replace date with date of run
write.table(repl, "./data/repl_water_18feb2016.csv", quote = F, row.names = F, sep = ",")
sod <- read.delim("./data/leached_litter_SP_sod_18feb2016.csv", header = T, sep = ",")
std <- read.delim("./data/winkler_standardization_18feb2016.csv", header = T,  sep = ",")
vial <- read.delim("./data/vial_volume_summer_2014.csv", header = T,  sep = ",")
treat <- read.delim("./data/leached_litter_treatments_Spring2016.csv", header = T, sep = ",")
repl <- read.delim("./data/repl_water_18feb2016.csv", header = T, sep = ",")
BODwatervol <- 200
## Add treatments to sod data.frame for T0
sod <- merge(sod, treat, by = "bod" )
# DO Calculations
## Add vial vial volumes to the sod data.frame for T0
sodT0 <- merge(sod, vial, by.x = "vialT0", by.y = "vial")
## Calculation of [DO] of T0 samples
DOvol.T0 <- (((sod$RmeasT0 - std$Rblk) * std$Vstd * std$Nstd * std$E) / ((std$Rstd - std$Rblk) * (sodT0$vol - std$Vreg))) - std$DOreg
## Add vial vial volumes to the sod data.dframe for T1
sodTF <- merge(sod, vial, by.x = "vialTF", by.y = "vial")
## Calculation of [DO] of TF samples
DOvol.TF <- (((sod$RmeasTF - std$Rblk) * std$Vstd * std$Nstd * std$E) / ((std$Rstd - std$Rblk) * (sodTF$vol - std$Vreg))) - std$DOreg
## Calculation of the [DO] of the replacement water
replDOvol <- (((repl$Rmeas - std$Rblk) * std$Vstd * std$Nstd * std$E) / ((std$Rstd - std$Rblk) * (sodTF$vol - std$Vreg))) - std$DOreg
## Convert from ml/L to mmol/L
R <- 0.08205746 # ideal gas constant in (L atm)/(mol K)
T <- sod$temp + 273.15 # convert C to K
P <- sod$pressure * 0.03342 # convert in Hg to atm
DOmmol.T0 <- (P * DOvol.T0) / (R * T)
DOmmol.TF <- (P * DOvol.TF) / (R * T)
# Make a data.frame with just the concentration data
DO.conc <- data.frame(sod$bod, sod$treat, DOmmol.T0, DOmmol.TF)
## write a data table of the concentration data
##write.table(DO.conc, "./data/leached_litter_DOconc_08oct2015.csv", row.names = F, quote = F, sep = ",")
# SOD Calculations
replDOmmol <- (P * replDOvol) / (R * T)
## Calculate the mean replacement water [DO]
meanReplDOmmol <- mean(replDOmmol)
## Calculation of T0 DO concentration
DO.T0 <- (DOmmol.T0 * (1 - (sod$Replvol / BODwatervol))) + (meanReplDOmmol * (sod$Replvol / BODwatervol))
## Calculation of mmols of oxygen in the bottles
DOmmol.bot.T0 <- DO.T0 * (BODwatervol / 1000) # converting bottle volume from ml to L
DOmmol.bot.TF <- DOmmol.TF * (BODwatervol / 1000) # converting bottle volume from ml to L
## Calculation of change in mmol DO during incubation
dDO <- DOmmol.bot.T0 - DOmmol.bot.TF
## Normalize by sediment area --> convert to per m2
mmolO2.m2 <- dDO / sod$A
## Convert times to POSIXlt standard
t0 <- as.POSIXlt(sod$time0)
tF <- as.POSIXlt(sod$timeF)
## Calculate the incubation hours
incubation.h <- tF - t0
incubation.h <- as.numeric(incubation.h)
## Normalize by hours of incubation
mmolO2.m2.h <- mmolO2.m2 / incubation.h
## Make data frame of relevant variables
flux <- data.frame(sodTF$bod, sodTF$treat, sodTF$temp, dDO, DOmmol.T0, DOmmol.TF, DO.T0, incubation.h, mmolO2.m2.h)
names(flux) <- c("bod", "treatment", "temp", "dDO", "DOpre", "DOpost", "DO.T0", "incubation.h", "SOD")
plot(SOD ~ jitter(as.numeric(treatment), 1), data = flux)
plot(SOD ~ jitter(as.numeric(treatment), 1), data = flux, ylim = c(0, 1))
plot(SOD ~ as.factor(treatment), data = flux)
plot(SOD ~ jitter(as.numeric(treatment), 0.5), data = flux, ylim = c(0, 1))
write.table(flux, "./data/leached_litter_sp_sod_calculation_18feb2016.csv", quote = F, row.names = F, sep = ",")
